
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>IC卡读卡器|IC卡读写器|NFC读写器|二代证阅读器|工业物联网DTU|串口转以太网模块|串口服务器|身份证阅读器|RFID读写器 - 智能卡读写器浏览器应用</title>
    <meta name="keywords" content="IC卡读卡器|IC卡读写器|RFID读写器|NFC读写器|二代证阅读器|工业物联网DTU|串口服务器">
    <meta name="description" content="重庆诺塔斯(LotusSmart)智能科技有限公司致力于研发和生产各种智能卡读写器、非接触式IC卡读写器、CPU卡读写器,充电桩IC卡读写器,NFC读写器,二代证阅读器、RFID读写器、串口服务器、工业物联网DTU、RTU等产品的创新型物联网公司，公司拥有先进的研发团队和良好的售后服务体系。我们将继续以“树民族科技，创世界品牌”为坐标，不断的创新突破，超越自我，让更多、更好、更专业的产品走进千家万户，实现自己的价值。">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name = "viewport" content = "width = 320, initial-scale = 1.0, user-scalable = yes">
    <script language="javascript" type="text/javascript">
        function getNowFormatDate() {
            var date = new Date();
            var seperator1 = "-";
            var seperator2 = ":";
            var month = date.getMonth() + 1;
            var strDate = date.getDate();
            var socket = null;
            var nCommandIndex = 0;
            var strIp = "";
            var strPort = "";
            var wsUrl = "";
            if (month >= 1 && month <= 9) {
                month = "0" + month;
            }
            if (strDate >= 0 && strDate <= 9) {
                strDate = "0" + strDate;
            }
            var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
                + " " + date.getHours() + seperator2 + date.getMinutes()
                + seperator2 + date.getSeconds()
                + seperator2 + date.getMilliseconds();
            return currentdate;
        }
        function ConnectServer(){
            var protocolStr = document.location.protocol;
            document.getElementById('log').innerHTML = '<li><b>'+ protocolStr +'</b></li>' + document.getElementById('log').innerHTML;
            try {
                nCommandIndex = 0;
                strIp = document.getElementById('strLotusCardDeviceIp').value;
                strPort = document.getElementById('strLotusCardDevicePort').value;
                if(protocolStr == "https:")
                {
                    wsUrl = 'wss://'+ strIp +':'+  strPort;
                }
                else
                {
                    wsUrl = 'ws://'+ strIp +':'+  strPort;
                }
                socket = new WebSocket(wsUrl);
            } catch (evt) {
                document.getElementById('log').innerHTML = '<li><b>'+getNowFormatDate()+'#new WebSocket error:'+ evt.data+'</b></li>' + document.getElementById('log').innerHTML;
                socket = null;
                if (typeof(connCb) != "undefined" && connCb != null)
                    connCb("-1", "connect error!");
                return;
            }
            socket.onopen = function ()
            {
                document.getElementById('log').innerHTML = '<li><b>'+getNowFormatDate()+'#连接服务器成功</b></li>' + document.getElementById('log').innerHTML;
                document.getElementById('status').innerHTML = 'Socket Open';
                document.getElementById('status').className = 'online';
            };
            socket.onclose =  function(event)
            {
                document.getElementById('log').innerHTML = '<li><b>'+getNowFormatDate()+'#断开连接:' + event.wasClean + '</b></li>' + document.getElementById('log').innerHTML;
                document.getElementById('status').innerHTML = 'Socket Closed';
                document.getElementById('status').className = 'offline';
            };
            socket.onmessage = function(event)
            {
                var arrString =  new Array();
                strLastResult = event.data;
                //alert(strLastResult);
                arrString = strLastResult.split(',');
                //if(arrString.length>0)alert(arrString[0]);
                if('ReadId'== arrString[0])
                {
                    if(arrString.length>11)
                    {
                        document.getElementById('log').innerHTML = '<li><b>'+getNowFormatDate()+'#收到数据:' +
                            arrString[0] + ','+
                            arrString[1] + ','+
                            arrString[2] + ','+
                            arrString[3] + ','+
                            arrString[4] + ','+
                            arrString[5] + ','+
                            arrString[6] + ','+
                            arrString[7] + ','+
                            arrString[8] + ','+
                            arrString[9] + ','+
                            arrString[10]+
                            '</b></li>' + document.getElementById('log').innerHTML;
                        document.all['PhotoDisplay'].src = 'data:image/jpg;base64,' + arrString[11];
                    }
                    else
                    {
                        document.getElementById('log').innerHTML = '<li><b>'+getNowFormatDate()+'#收到数据:' + event.data + '</b></li>' + document.getElementById('log').innerHTML;
                    }
                }
                else if('ReadIdBuffer' == arrString[0])
                {
                    if(arrString.length>11)
                    {
                        document.getElementById('log').innerHTML = '<li><b>'+getNowFormatDate()+'#收到数据:' +
                            arrString[0] + ','+
                            arrString[1] + ','+
                            arrString[2] + ','+
                            arrString[3] + ','+
                            arrString[4] + ','+
                            arrString[5] + ','+
                            arrString[6] + ','+
                            arrString[7] + ','+
                            arrString[8] + ','+
                            arrString[9] + ','+
                            arrString[10]+
                            '</b></li>' + document.getElementById('log').innerHTML;
                        document.all['PhotoDisplay'].src = 'data:image/jpg;base64,' + arrString[11];
                    }
                    else
                    {
                        document.getElementById('log').innerHTML = '<li><b>'+getNowFormatDate()+'#收到数据:' + event.data + '</b></li>' + document.getElementById('log').innerHTML;
                    }

                }
                else if('ReadIdJpeg' == arrString[0])
                {

                    if(arrString.length>3)
                    {
                        if(arrString[3].length>200)
                        {
                            document.all['PhotoDisplay'].src = 'data:image/jpg;base64,' + arrString[3];
                        }
                        else
                        {
                            document.getElementById('log').innerHTML = '<li><b>'+getNowFormatDate()+'#收到数据:' + event.data + '</b></li>' + document.getElementById('log').innerHTML;
                        }
                    }
                    else
                    {
                        document.getElementById('log').innerHTML = '<li><b>'+getNowFormatDate()+'#收到数据:' + event.data + '</b></li>' + document.getElementById('log').innerHTML;
                    }
                }
                else
                {
                    document.getElementById('log').innerHTML = '<li><b>'+getNowFormatDate()+'#收到数据:' + event.data + '</b></li>' + document.getElementById('log').innerHTML;
                }
            };
            socket.onerror = function(event)
            {
                document.getElementById('log').innerHTML = '<li><b>#disconnected:' + event.message + '</b></li>' + document.getElementById('log').innerHTML;
                document.getElementById('status').innerHTML = 'Socket Error';
                document.getElementById('status').className = 'error';
            };
        }
        function ExecStringCommand(strCommand) {
            strLastResult = '';
            nCommandIndex++;
            if (socket.readyState == WebSocket.OPEN) {
                socket.send(strCommand+','+nCommandIndex);
            } else {
                document.getElementById('log').innerHTML = '<li><b>#send failed. websocket not open. please check.</b></li>' + document.getElementById('log').innerHTML;
            }
        }
        function  GetSocketStatus() {
            if(null == socket) return "socket is null";
            switch (socket.readyState) {
                case socket.CONNECTING:
                    return "connecting";
                    break;
                case socket.OPEN:
                    return "open";
                    break;
                case socket.CLOSING:
                    return "closing";
                    break;
                case socket.CLOSED:
                    return "closed";
                    break;
                default:
                    return "undefined";
                    break
            }
        }
    </script>

    <style>
        body {
            font-family:Verdana,Arial,"Times New Roman";
        }

        #status {
            padding: 5px;
            color: #fff;
            background: #ccc;
        }
        #status.error {
            background: #c00;
            font-weight: bold;
        }
        #status.offline {
            background: #c00;
            font-weight: bold;
        }
        #status.online {
            background: #0c0;
            font-weight: bold;
        }
    </style>
</head>
<body>
<h1>诺塔斯智能科技全兼容浏览器二代证阅读演示页面</h1>
<table width="100%">
    <tr style="width:100px; height:40px;">
        <td>
            读卡器IP:
        </td>
        <td>
            <input type="text" value="127.0.0.1" id="strLotusCardDeviceIp" style="width:150px; height:30px;" />
        </td>
    </tr>
    <tr style="width:100px; height:40px;">
        <td>
            读卡器PORT:
        </td>
        <td>
            <input type="text" value="31213" id="strLotusCardDevicePort" style="width:150px; height:30px;" />
        </td>
    </tr>

    <tr style="width:100px; height:40px;">
        <td>
            状态
        </td>
        <td>
            <p id="status"></p>
        </td>
    </tr>
    <tr style="width:100px; height:40px;">
        <td colspan="2">
            <h3>通信函数:1、连接服务器 2、执行字符串函数并解析结果 3、断开连接</h3>
        </td>
    </tr>
    <tr style="width:100px; height:40px;">
        <td>
            连接服务器:
        </td>
        <td>
            <INPUT id = "ConnectServer"  type=button value="ConnectServer" onclick="javascript:ConnectServer();" style="width:150px; height:30px;"/>
        </td>

    </tr>
    <tr style="width:100px; height:40px;">
        <td>
            关闭连接:
        </td>
        <td>
            <INPUT id = "CloseConnection"  type=button value="CloseConnection" onclick="javascript:socket.close();" style="width:150px; height:30px;"/>
        </td>
    </tr>
    <tr style="width:100px; height:40px;">
        <td>
            获取连接状态:
        </td>
        <td>
            <INPUT id = "ConnectionStatus"  type=button value="ConnectionStatus" onclick="javascript:document.getElementById('log').innerHTML = '<li><b>#status:' + GetSocketStatus() + '</b></li>' + document.getElementById('log').innerHTML;"
                   style="width:150px; height:30px;"/>
        </td>
    </tr>
    <tr style="width:100px; height:40px;">
        <td>
            获取MCU序列号:
        </td>
        <td>
            <INPUT id = "OpenDevice"  type=button value="GetMcuSerailNo" onclick="javascript:ExecStringCommand('GetMcuSerailNo')" style="width:150px; height:30px;"/>
        </td>
    </tr>

    <tr style="width:100px; height:40px;">
        <td>
            蜂鸣:
        </td>
        <td>
            <INPUT id = "Beep"  type=button value="Beep" onclick="javascript:ExecStringCommand('Beep,10');" style="width:150px; height:30px;"/>
        </td>
    </tr>
    <tr style="width:100px; height:40px;">
        <td>
            读二代证:
        </td>
        <td>
            <INPUT id = "ReadId"  type=button value="ReadId" onclick="javascript:ExecStringCommand('ReadId');" style="width:150px; height:30px;"/>
        </td>
    </tr>
    <tr style="width:100px; height:40px;">
        <td>
            读二代证缓冲:
        </td>
        <td>
            <INPUT id = "ReadIdBuffer"  type=button value="ReadIdBuffer" onclick="javascript:ExecStringCommand('ReadIdBuffer');" style="width:150px; height:30px;"/>
        </td>
    </tr>
    <tr style="width:100px; height:40px;">
        <td>
            读二代证B64编码JPEG照片:
        </td>
        <td>
            <INPUT id = "ReadIdJpeg"  type=button value="ReadIdJpeg" onclick="javascript:ExecStringCommand('ReadIdJpeg');" style="width:150px; height:30px;"/>
        </td>
    </tr>

    <tr style="width:100px; height:40px;">
        <td>
            清除二代证读取缓冲:
        </td>
        <td>
            <INPUT id = "ClearIdBuffer"  type=button value="ClearIdBuffer" onclick="javascript:ExecStringCommand('ClearIdBuffer');" style="width:150px; height:30px;"/>
        </td>
    </tr>

    <tr style="width:100px; height:40px;">
        <td>
            清除日志:
        </td>
        <td>
            <INPUT id = "ClearLog"  type=button value="ClearLog" onclick="javascript:document.getElementById('log').innerHTML = '';document.all['PhotoDisplay'].src = '';" style="width:150px; height:30px;"/>
        </td>
    </tr>

    <tr style="width:100px; height:40px;">
        <td>
            照片:
        </td>
        <td>
            <IMG style="WIDTH: 124px; HEIGHT: 150px"   name=PhotoDisplay>
        </td>
    </tr>
    <td colspan="2">
        <h3>日志</h3>
    </td>
    </tr>
    <tr>
        <td colspan="2">
            <ul id="log" style="overflow: auto; list-style: none; padding:0; background:#ffffff; font-size:small; border-style:solid; border-color:#c0c0c0"></ul>
        </td>
    </tr>
</table>

</body>
</html>

